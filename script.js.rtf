{\rtf1\ansi\ansicpg1251\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs28 \cf0 let ws;\
let myBoard = [];\
let enemyBoard = [];\
let myBoardDiv = document.getElementById('myBoard');\
let enemyBoardDiv = document.getElementById('enemyBoard');\
let status = document.getElementById('status');\
let myTurn = false;\
\
document.getElementById('joinBtn').onclick = () => \{\
    const roomId = document.getElementById('roomId').value;\
    if(!roomId) return alert('\uc0\u1042 \u1074 \u1077 \u1076 \u1080 \u1090 \u1077  ID \u1082 \u1086 \u1084 \u1085 \u1072 \u1090 \u1099 ');\
\
    ws = new WebSocket(`wss://$\{location.hostname\}`);\
\
    ws.onopen = () => ws.send(JSON.stringify(\{ type: 'join', roomId \}));\
\
    ws.onmessage = (msg) => \{\
        const data = JSON.parse(msg.data);\
\
        if(data.type === 'start')\{\
            document.getElementById('game').style.display = 'block';\
            initBoards();\
            myTurn = data.turn;\
            updateStatus();\
        \}\
\
        if(data.type === 'opponent-move')\{\
            const cell = data.cell;\
            const x = cell.x, y = cell.y;\
            const hit = myBoard[x][y] === 1;\
            myBoard[x][y] = hit ? 2 : 3;\
            renderBoard(myBoardDiv, myBoard, false);\
            myTurn = true;\
            updateStatus(hit ? "\uc0\u1055 \u1088 \u1086 \u1090 \u1080 \u1074 \u1085 \u1080 \u1082  \u1087 \u1086 \u1087 \u1072 \u1083 !" : "\u1055 \u1088 \u1086 \u1090 \u1080 \u1074 \u1085 \u1080 \u1082  \u1087 \u1088 \u1086 \u1084 \u1072 \u1093 \u1085 \u1091 \u1083 \u1089 \u1103 ");\
            checkVictory();\
        \}\
    \}\
\}\
\
function initBoards()\{\
    for(let i=0;i<10;i++)\{\
        myBoard[i] = [];\
        enemyBoard[i] = [];\
        for(let j=0;j<10;j++)\{\
            myBoard[i][j] = 0;\
            enemyBoard[i][j] = 0;\
        \}\
    \}\
    for(let k=0;k<5;k++)\{\
        let x = Math.floor(Math.random()*10);\
        let y = Math.floor(Math.random()*10);\
        myBoard[x][y] = 1;\
    \}\
    renderBoard(myBoardDiv, myBoard, false);\
    renderBoard(enemyBoardDiv, enemyBoard, true);\
\}\
\
function renderBoard(boardDiv, board, clickable)\{\
    boardDiv.innerHTML = '';\
    for(let i=0;i<10;i++)\{\
        for(let j=0;j<10;j++)\{\
            const cellDiv = document.createElement('div');\
            cellDiv.classList.add('cell');\
            if(board[i][j] === 1) cellDiv.classList.add('ship');\
            if(board[i][j] === 2) cellDiv.classList.add('hit');\
            if(board[i][j] === 3) cellDiv.classList.add('miss');\
\
            if(clickable && myTurn)\{\
                cellDiv.onclick = () => \{\
                    if(enemyBoard[i][j] !== 0) return;\
                    ws.send(JSON.stringify(\{ type:'move', cell:\{x:i, y:j\} \}));\
                    enemyBoard[i][j] = 3;\
                    renderBoard(enemyBoardDiv, enemyBoard, true);\
                    myTurn = false;\
                    updateStatus("\uc0\u1061 \u1086 \u1076  \u1087 \u1088 \u1086 \u1090 \u1080 \u1074 \u1085 \u1080 \u1082 \u1072 ...");\
                \}\
            \}\
\
            boardDiv.appendChild(cellDiv);\
        \}\
    \}\
\}\
\
function updateStatus(msg)\{\
    if(msg) status.innerText = msg;\
    else status.innerText = myTurn ? "\uc0\u1042 \u1072 \u1096  \u1093 \u1086 \u1076 !" : "\u1061 \u1086 \u1076  \u1087 \u1088 \u1086 \u1090 \u1080 \u1074 \u1085 \u1080 \u1082 \u1072 ...";\
\}\
\
function checkVictory()\{\
    const myShipsLeft = myBoard.flat().filter(c => c===1).length;\
    const enemyShipsLeft = enemyBoard.flat().filter(c => c===1).length;\
    if(myShipsLeft===0)\{\
        status.innerText = "\uc0\u1042 \u1099  \u1087 \u1088 \u1086 \u1080 \u1075 \u1088 \u1072 \u1083 \u1080 !";\
        myTurn = false;\
    \}\
    if(enemyShipsLeft===0)\{\
        status.innerText = "\uc0\u1042 \u1099  \u1087 \u1086 \u1073 \u1077 \u1076 \u1080 \u1083 \u1080 !";\
        myTurn = false;\
    \}\
\}\

\fs24 1\
}